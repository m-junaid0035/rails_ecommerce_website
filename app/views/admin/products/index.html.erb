<% content_for :title, "Products" %>

<div class="w-full max-w-full">
  <% if notice.present? %>
    <p class="py-3 px-4 bg-green-100 mb-6 text-green-700 font-semibold rounded-lg inline-block shadow-sm" id="notice">
      <%= notice %>
    </p>
  <% end %>

  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4">
    <h1 class="font-extrabold text-3xl sm:text-4xl text-gray-900">Products</h1>
    <%= link_to "New product", new_admin_product_path, class: "rounded-md px-5 py-3 bg-gradient-to-r from-teal-500 to-teal-400 hover:from-teal-600 hover:to-teal-500 text-white font-semibold shadow-lg transition-transform transform hover:scale-105" %>
  </div>

  <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8">
    <%= form_with url: admin_products_path, method: :get, class: "flex w-full md:w-auto space-x-2" do |form| %>
      <%= form.text_field :query, placeholder: "Search products...", aria: { label: "Search products" }, class: "w-full md:w-72 rounded-lg border border-gray-300 px-4 py-3 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition" %>
      <%= form.submit "Search", class: "cursor-pointer bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition" %>
    <% end %>

    <%= form_with url: admin_products_path, method: :get, class: 'w-full md:w-auto' do |form| %>
      <%= form.submit "Clear", class: "cursor-pointer bg-red-400 hover:bg-amber-500 text-white font-semibold py-3 px-6 rounded-lg shadow-md w-full md:w-auto transition" %>
    <% end %>
  </div>

  <div class="overflow-x-auto rounded-xl shadow-lg border border-gray-200 bg-white">
    <table class="min-w-full divide-y divide-gray-200 text-gray-900">
      <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
        <tr>
          <th class="px-6 py-4 text-left text-sm font-semibold whitespace-nowrap"></th>
          <th class="px-6 py-4 text-left text-sm font-semibold whitespace-nowrap">Name</th>
          <th class="px-6 py-4 text-left text-sm font-semibold whitespace-nowrap">Description</th>
          <th class="px-6 py-4 text-left text-sm font-semibold whitespace-nowrap">Price</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <% @admin_products.each_with_index do |p, index| %>
          <tr class="<%= index.even? ? 'bg-white' : 'bg-gray-50' %> hover:bg-blue-50 transition-colors duration-200">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              <% if p.images.attached? && p.images.any? %>
                <%= image_tag url_for(p.images.first.variant(resize_to_limit: [50, 50])), alt: "#{p.name} image", class: "rounded-lg object-cover w-12 h-12 shadow-sm" %>
              <% else %>
                <%= image_tag "https://via.placeholder.com/50", alt: "Placeholder image", class: "rounded-lg object-cover w-12 h-12 shadow-sm" %>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600 underline">
              <%= link_to p.name, edit_admin_product_path(p), class: "hover:text-blue-800 transition" %>
            </td>
            <td class="px-6 py-4 text-sm text-gray-700 max-w-xs truncate" title="<%= p.description %>">
              <%= p.description %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
              $<%= (p.price / 100.0).to_s %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
</div>
